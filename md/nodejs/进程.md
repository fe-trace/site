## 进程变迁

### 同步进程
同步阻塞方式进行请求处理，每次只能处理一个请求，处理完成后再处理下一个。并发能力低。

### 多进程
同步方式存在处理效率低下的问题，为了解决并发问题，多进程架构开始出现。但是每请求每进程的处理方式，资源消耗大。

### 多线程
多进程在一定程度上解决了并发问题，但是消耗的资源也随之增加，为了提高请求处理能力，多线程处理方式开始流行，进行使用的资源相对线程更小，处理请求的能力会更强。

### 事件驱动
多线程方式在一段时间内效率和性能能够满足需求，但在到并发情况下，资源消耗还是会直线增加。为了解决高并发问题，事件驱动的服务模型出现了，采用单线程能避免了上下文切换等带来的内存消耗。同时也引入了两个问题：
1.如何利用多核CPU
2.进程的健壮性如何保证

### 多进程架构
为了解决单线程不能充分利用多核CPU的问题，使用多进程方式处理请求是一个不错的方案。
文件描述符：https://www.jianshu.com/p/a2df1d402b4d

### 多进程监听相同端口
如果单独启动多进程监听不同端口会造成文件描述符的浪费，使用主从模式，主从进程之间可以通过共享文件描述符来监听到同一个端口。主进程发送文件server对象到子进程时，可以取到对应的文件描述符，底层会新建server对象同时监听到文件描述符上实现监听同一个端口。

### 集群稳定
1.子进程出现异常后退出当前进程并通知主进程新建子进程进行服务
2.子进程发生异常时可以先通知主进程再等待子进程退出
3.子进程退出时可以设置超时时间避免一直等待退出
4.需要判断是否一直重启，如果连续重启时间过短就停止重启

### 轮调度
nodeJS进程的服务方式是抢占式服务，每个进程根据自己的繁忙程度进行抢占。对node而言，繁忙程度由CPU和IO决定，影响抢占的因素是CPU，这就可能造成某个进程抢占较多，但是IO相应过慢，导致负载不均衡的情况。在 Node v0.11 中提供了新的调度方式：轮调度。通过主进程分配请求的方式实现，缺点就是消耗两倍的文件描述符。

### cluster模块
cluster 模块提供了处理多线程以及进程稳定的实现方案

### 进程间通信
1.管道：适用于父子进程之间，进程通信时两个进程一个进行写操作，一个进行读操作
2.命名管道：所有的读操作都指向命名管道，有数据时管道进行读取-> 处理 -> 返回
3.消息队列：
4.共享内存